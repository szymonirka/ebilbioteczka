<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>SzczegÃ³Å‚y ksiÄ…Å¼ki</title>
</head>
<body>
<h1>SzczegÃ³Å‚y ksiÄ…Å¼ki</h1>
<div id="book_details"></div>
<div id="pdf_viewer"></div>
<div id="fav_buttons" style="margin-top: 10px;">
    <button onclick="addToFavorites()">ğŸ’– Dodaj do ulubionych</button>
    <button onclick="removeFromFavorites()">âŒ UsuÅ„ z ulubionych</button>
</div>
<a href="index.html">â† PowrÃ³t do listy</a>

<script>
    let bookId;
    const token = localStorage.getItem('token');
    async function loadBookDetails() {
        const params = new URLSearchParams(window.location.search);
        bookId = params.get('id');

        if (!bookId) {
            document.getElementById('book_details').textContent = 'Brak ID ksiÄ…Å¼ki';
            return;
        }

        try {
            const res = await fetch(`/api/books/${bookId}`);
            const book = await res.json();

            document.getElementById('book_details').innerHTML = `
            <h2>${book.title}</h2>
            <p><strong>Autor:</strong> ${book.author}</p>
        `;

            // jeÅ›li jest PDF i uÅ¼ytkownik zalogowany
            const token = localStorage.getItem('token');
            if (token && book.pdf_path) {
                document.getElementById('pdf_viewer').innerHTML = `
                <h3>ğŸ“– Czytaj ksiÄ…Å¼kÄ™:</h3>
                <iframe src="${book.pdf_path}" width="100%" height="600px"></iframe>
            `;
            }
        } catch (err) {
            document.getElementById('book_details').textContent = 'âŒ BÅ‚Ä…d Å‚adowania ksiÄ…Å¼ki';
        }
    }

    async function addToFavorites() {
        if (!token) {
            alert("Musisz byÄ‡ zalogowany, by dodaÄ‡ do ulubionych.");
            return;
        }

        try {
            const res = await fetch(`/api/favorites/${bookId}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const data = await res.json();
            alert(data.message || 'Dodano do ulubionych');
        } catch (err) {
            alert('âŒ BÅ‚Ä…d dodawania do ulubionych');
        }
    }

    async function removeFromFavorites() {
        if (!token) {
            alert("Musisz byÄ‡ zalogowany, by usunÄ…Ä‡ z ulubionych.");
            return;
        }

        try {
            const res = await fetch(`/api/favorites/${bookId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const data = await res.json();
            alert(data.message || 'UsuniÄ™to z ulubionych');
        } catch (err) {
            alert('âŒ BÅ‚Ä…d usuwania z ulubionych');
        }
    }

    window.addEventListener('DOMContentLoaded', loadBookDetails);
</script>
</body>
</html>
