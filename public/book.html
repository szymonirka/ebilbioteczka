<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Szczegóły książki</title>
</head>
<body>
<h1>Szczegóły książki</h1>
<div id="book_details"></div>
<div id="pdf_viewer"></div>
<div id="fav_buttons" style="margin-top: 10px;">
    <button onclick="addToFavorites()">💖 Dodaj do ulubionych</button>
    <button onclick="removeFromFavorites()">❌ Usuń z ulubionych</button>
</div>
<a href="index.html">← Powrót do listy</a>

<script>
    let bookId;
    const token = localStorage.getItem('token');
    async function loadBookDetails() {
        const params = new URLSearchParams(window.location.search);
        bookId = params.get('id');

        if (!bookId) {
            document.getElementById('book_details').textContent = 'Brak ID książki';
            return;
        }

        try {
            const res = await fetch(`/api/books/${bookId}`);
            const book = await res.json();

            document.getElementById('book_details').innerHTML = `
            <h2>${book.title}</h2>
            <p><strong>Autor:</strong> ${book.author}</p>
        `;

            // jeśli jest PDF i użytkownik zalogowany
            const token = localStorage.getItem('token');
            if (token && book.pdf_path) {
                document.getElementById('pdf_viewer').innerHTML = `
                <h3>📖 Czytaj książkę:</h3>
                <iframe src="${book.pdf_path}" width="100%" height="600px"></iframe>
            `;
            }
        } catch (err) {
            document.getElementById('book_details').textContent = '❌ Błąd ładowania książki';
        }
    }

    async function addToFavorites() {
        if (!token) {
            alert("Musisz być zalogowany, by dodać do ulubionych.");
            return;
        }

        try {
            const res = await fetch(`/api/favorites/${bookId}`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const data = await res.json();
            alert(data.message || 'Dodano do ulubionych');
        } catch (err) {
            alert('❌ Błąd dodawania do ulubionych');
        }
    }

    async function removeFromFavorites() {
        if (!token) {
            alert("Musisz być zalogowany, by usunąć z ulubionych.");
            return;
        }

        try {
            const res = await fetch(`/api/favorites/${bookId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const data = await res.json();
            alert(data.message || 'Usunięto z ulubionych');
        } catch (err) {
            alert('❌ Błąd usuwania z ulubionych');
        }
    }

    window.addEventListener('DOMContentLoaded', loadBookDetails);
</script>
</body>
</html>
